<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ æ‹¿å¤§ç§»æ°‘å¤„ç†æ—¶é—´æŸ¥è¯¢å™¨ - æ ‘å½¢å±•ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Courier New', monospace, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header .flag {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .controls {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .control-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-group select:hover {
            border-color: #667eea;
        }

        .control-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #e0e0e0;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .results {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .results.show {
            display: block;
        }

        .results h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        /* æ ‘å½¢ç»“æ„æ ·å¼ */
        .tree-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 30px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.8;
            overflow-x: auto;
        }

        .tree-line {
            white-space: pre;
            margin: 0;
            padding: 2px 0;
            transition: background 0.2s;
        }

        .tree-line:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .tree-category {
            color: #4ec9b0;
            font-weight: 700;
            font-size: 15px;
            margin-top: 15px;
        }

        .tree-category:first-child {
            margin-top: 0;
        }

        .tree-branch {
            color: #808080;
        }

        .tree-item {
            color: #9cdcfe;
        }

        .tree-time {
            color: #ce9178;
            font-weight: 600;
        }

        .tree-time.pending {
            color: #858585;
            font-style: italic;
        }

        .tree-time.success {
            color: #4ec9b0;
        }

        .tree-time.error {
            color: #f48771;
        }

        .tree-dots {
            color: #404040;
        }

        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .export-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
            display: flex;
            gap: 15px;
        }

        .view-toggle {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .view-toggle-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .view-toggle-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .tree-header {
            color: #569cd6;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #404040;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .tree-container {
                font-size: 12px;
                padding: 20px 15px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="flag">ğŸ‡¨ğŸ‡¦</div>
            <h1>åŠ æ‹¿å¤§ç§»æ°‘å¤„ç†æ—¶é—´æŸ¥è¯¢å™¨</h1>
            <p>æ ‘å½¢ç»“æ„å±•ç¤º - é€‰æ‹©å›½å®¶ï¼ŒæŸ¥çœ‹æ‰€æœ‰ç”³è¯·ç±»å‹çš„å¤„ç†æ—¶é—´</p>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="control-group">
                <label for="countrySelect">ğŸŒ é€‰æ‹©ç”³è¯·å›½å®¶/åœ°åŒº</label>
                <select id="countrySelect">
                    <option value="">-- è¯·é€‰æ‹©å›½å®¶ --</option>
                    <optgroup label="å¸¸ç”¨å›½å®¶">
                        <option value="China (People's Republic of)">China (People's Republic of)</option>
                        <option value="India">India</option>
                        <option value="Philippines">Philippines</option>
                        <option value="United States of America">United States of America</option>
                        <option value="United Kingdom">United Kingdom</option>
                        <option value="France">France</option>
                        <option value="Germany">Germany</option>
                        <option value="Australia">Australia</option>
                        <option value="Japan">Japan</option>
                        <option value="South Korea">South Korea</option>
                    </optgroup>
                </select>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="loadDemoBtn">
                    ğŸ¨ åŠ è½½æ¼”ç¤ºæ•°æ®ï¼ˆä¸­å›½æ ·æœ¬ï¼‰
                </button>
            </div>

            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #ffc107;">
                <strong>ğŸ’¡ å¦‚ä½•è·å–å®é™…æ•°æ®ï¼š</strong>
                <ol style="margin: 10px 0 0 20px; line-height: 1.8;">
                    <li>ğŸ“– æŸ¥çœ‹è¯¦ç»†æ•™ç¨‹: <a href="HOW_TO_GET_REAL_DATA.md" target="_blank" style="color: #667eea; font-weight: 600;">HOW_TO_GET_REAL_DATA.md</a></li>
                    <li>ğŸŒ åœ¨ç›®æ ‡ç½‘ç«™æ§åˆ¶å°è¿è¡ŒæŸ¥è¯¢è„šæœ¬</li>
                    <li>ğŸ“¤ ç‚¹å‡»ä¸‹æ–¹"å¯¼å…¥JSONæ•°æ®"æŒ‰é’®ç²˜è´´ç»“æœ</li>
                </ol>
            </div>
        </div>

        <!-- Results -->
        <div class="results" id="resultsBox">
            <div class="summary" id="summaryBox">
                <div class="summary-item">
                    <div class="summary-value" id="totalCount">0</div>
                    <div class="summary-label">æ€»ç”³è¯·ç±»å‹</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="completedCount">0</div>
                    <div class="summary-label">å·²æŸ¥è¯¢</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="successCount">0</div>
                    <div class="summary-label">æŸ¥è¯¢æˆåŠŸ</div>
                </div>
            </div>

            <h2>ğŸ“Š å¤„ç†æ—¶é—´æ ‘å½¢å±•ç¤º</h2>

            <!-- Tree Container -->
            <div class="tree-container" id="treeContainer">
                <div class="tree-header">ğŸ‡¨ğŸ‡¦ Canada Immigration Processing Times</div>
                <div id="treeContent"></div>
            </div>

            <div class="export-section">
                <button class="btn btn-secondary" id="importJsonBtn">
                    ğŸ“¤ å¯¼å…¥JSONæ•°æ®
                </button>
                <button class="btn btn-secondary" id="exportTreeBtn">
                    ğŸ“„ å¯¼å‡ºä¸ºæ–‡æœ¬æ–‡ä»¶
                </button>
                <button class="btn btn-secondary" id="exportJsonBtn">
                    ğŸ“¥ å¯¼å‡ºä¸ºJSON
                </button>
                <button class="btn btn-secondary" id="copyTreeBtn">
                    ğŸ“‹ å¤åˆ¶æ ‘å½¢ç»“æ„
                </button>
            </div>
        </div>

        <!-- Import Modal -->
        <div id="importModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; padding: 20px;">
            <div style="max-width: 800px; margin: 50px auto; background: white; border-radius: 15px; padding: 30px; max-height: 80vh; overflow-y: auto;">
                <h2 style="margin-bottom: 20px;">ğŸ“¤ å¯¼å…¥å¤„ç†æ—¶é—´æ•°æ®</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    ç²˜è´´ä» <code>queryAllProcessingTimes()</code> æˆ–å…¶ä»–æ¥æºè·å–çš„JSONæ•°æ®ï¼š
                </p>
                <textarea id="importTextarea"
                    style="width: 100%; height: 300px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 13px;"
                    placeholder='ç²˜è´´JSONæ•°æ®ï¼Œä¾‹å¦‚ï¼š
{
  "Temporary residence": {
    "Visitor visa (from outside Canada)": "11 ä¸ªæœˆ",
    "Study permit (from outside Canada)": "8 å‘¨"
  },
  "Economic immigration": {
    "Express Entry": "6 ä¸ªæœˆ"
  }
}'></textarea>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="btn btn-primary" id="importConfirmBtn" style="flex: 1;">
                        âœ… å¯¼å…¥å¹¶æ˜¾ç¤º
                    </button>
                    <button class="btn btn-secondary" id="importCancelBtn" style="flex: 1;">
                        âŒ å–æ¶ˆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application types
        const APPLICATION_TYPES = {
            "Temporary residence (visiting, studying, working)": [
                "Visitor visa (from outside Canada)",
                "Visitor visa (from inside Canada)",
                "Visitor extension (Visitor record)",
                "Super visa (parents or grandparents)",
                "Study permit (from outside Canada)",
                "Study permit (from inside Canada)",
                "Study permit extension",
                "Work permit (from outside Canada)",
                "Work permit from inside Canada (initial and extension)",
                "Seasonal Agricultural Worker Program (SAWP)",
                "International Experience Canada (IEC)",
                "Electronic Travel Authorization (eTA)"
            ],
            "Economic immigration": [
                "Express Entry",
                "Provincial Nominee Program",
                "Quebec-selected skilled workers",
                "Atlantic Immigration Program",
                "Rural and Northern Immigration Pilot",
                "Agri-Food Pilot",
                "Home Child Care Provider Pilot",
                "Home Support Worker Pilot"
            ],
            "Family sponsorship": [
                "Spouse, partner or child",
                "Parents and grandparents",
                "Other relatives"
            ],
            "Citizenship": [
                "Citizenship grant",
                "Citizenship certificate",
                "Citizenship resumption"
            ],
            "Permanent resident cards": [
                "New card",
                "Renewal card",
                "Replacement card"
            ]
        };

        // Demo data for China
        const DEMO_DATA = {
            "Temporary residence (visiting, studying, working)": {
                "Visitor visa (from outside Canada)": "11 ä¸ªæœˆ",
                "Visitor visa (from inside Canada)": "19 å‘¨",
                "Visitor extension (Visitor record)": "184 å¤©",
                "Super visa (parents or grandparents)": "122 å¤©",
                "Study permit (from outside Canada)": "8 å‘¨",
                "Study permit (from inside Canada)": "89 å¤©",
                "Study permit extension": "56 å¤©",
                "Work permit (from outside Canada)": "14 å‘¨",
                "Work permit from inside Canada (initial and extension)": "97 å¤©",
                "Seasonal Agricultural Worker Program (SAWP)": "6 å‘¨",
                "International Experience Canada (IEC)": "8 å‘¨",
                "Electronic Travel Authorization (eTA)": "å³æ—¶"
            },
            "Economic immigration": {
                "Express Entry": "6 ä¸ªæœˆ",
                "Provincial Nominee Program": "18 ä¸ªæœˆ",
                "Quebec-selected skilled workers": "24 ä¸ªæœˆ",
                "Atlantic Immigration Program": "8 ä¸ªæœˆ",
                "Rural and Northern Immigration Pilot": "10 ä¸ªæœˆ",
                "Agri-Food Pilot": "12 ä¸ªæœˆ",
                "Home Child Care Provider Pilot": "15 ä¸ªæœˆ",
                "Home Support Worker Pilot": "15 ä¸ªæœˆ"
            },
            "Family sponsorship": {
                "Spouse, partner or child": "12 ä¸ªæœˆ",
                "Parents and grandparents": "24 ä¸ªæœˆ",
                "Other relatives": "60 ä¸ªæœˆ"
            },
            "Citizenship": {
                "Citizenship grant": "13 ä¸ªæœˆ",
                "Citizenship certificate": "6 ä¸ªæœˆ",
                "Citizenship resumption": "5 ä¸ªæœˆ"
            },
            "Permanent resident cards": {
                "New card": "104 å¤©",
                "Renewal card": "74 å¤©",
                "Replacement card": "74 å¤©"
            }
        };

        let allResults = {};
        let selectedCountry = "";

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('countrySelect').addEventListener('change', function(e) {
                selectedCountry = e.target.value;
            });

            document.getElementById('loadDemoBtn').addEventListener('click', loadDemoData);
            document.getElementById('importJsonBtn').addEventListener('click', showImportModal);
            document.getElementById('importConfirmBtn').addEventListener('click', importData);
            document.getElementById('importCancelBtn').addEventListener('click', hideImportModal);
            document.getElementById('exportTreeBtn').addEventListener('click', exportAsText);
            document.getElementById('exportJsonBtn').addEventListener('click', exportAsJson);
            document.getElementById('copyTreeBtn').addEventListener('click', copyTree);
        }

        function showImportModal() {
            document.getElementById('importModal').style.display = 'block';
            document.getElementById('importTextarea').value = '';
            document.getElementById('importTextarea').focus();
        }

        function hideImportModal() {
            document.getElementById('importModal').style.display = 'none';
        }

        function importData() {
            const textarea = document.getElementById('importTextarea');
            const jsonText = textarea.value.trim();

            if (!jsonText) {
                alert('è¯·ç²˜è´´JSONæ•°æ®');
                return;
            }

            try {
                // Try to parse as JSON
                const data = JSON.parse(jsonText);

                // Check if it's the full format with country/queryDate or just results
                if (data.results) {
                    allResults = data.results;
                    selectedCountry = data.country || selectedCountry;
                } else {
                    // Assume it's just the results object
                    allResults = data;
                }

                // Update country selector if we got country info
                if (selectedCountry) {
                    document.getElementById('countrySelect').value = selectedCountry;
                }

                renderTree();
                updateSummary();
                document.getElementById('resultsBox').classList.add('show');
                hideImportModal();

                // Show success message
                const btn = document.getElementById('importJsonBtn');
                const originalText = btn.textContent;
                btn.textContent = 'âœ… å¯¼å…¥æˆåŠŸï¼';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);

            } catch (error) {
                alert('JSONæ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼ï¼š\n\n' + error.message);
                console.error('Import error:', error);
            }
        }

        function loadDemoData() {
            selectedCountry = document.getElementById('countrySelect').value || "China (People's Republic of)";
            document.getElementById('countrySelect').value = "China (People's Republic of)";

            allResults = DEMO_DATA;
            renderTree();
            updateSummary();
            document.getElementById('resultsBox').classList.add('show');
        }

        function renderTree() {
            const container = document.getElementById('treeContent');
            container.innerHTML = '';

            const categories = Object.keys(APPLICATION_TYPES);

            categories.forEach((category, catIndex) => {
                const isLastCategory = catIndex === categories.length - 1;

                // Category line
                const categoryLine = createTreeLine(category, 'tree-category');
                container.appendChild(categoryLine);

                // Items
                const types = APPLICATION_TYPES[category];
                types.forEach((type, typeIndex) => {
                    const isLastItem = typeIndex === types.length - 1;
                    const branch = isLastItem ? 'â””â”€â”€' : 'â”œâ”€â”€';
                    const time = allResults[category]?.[type] || 'æ—¶é—´å¾…æŸ¥è¯¢';
                    const timeClass = allResults[category]?.[type] ? 'success' : 'pending';

                    const dots = 'Â·'.repeat(Math.max(2, 50 - type.length));
                    const line = `  <span class="tree-branch">${branch}</span> <span class="tree-item">${type}</span> <span class="tree-dots">${dots}</span> <span class="tree-time ${timeClass}">${time}</span>`;

                    const itemLine = createTreeLine(line);
                    container.appendChild(itemLine);
                });

                // Add spacing between categories
                if (!isLastCategory) {
                    container.appendChild(createTreeLine('â”‚', 'tree-branch'));
                }
            });
        }

        function createTreeLine(content, className = '') {
            const div = document.createElement('div');
            div.className = `tree-line ${className}`;
            div.innerHTML = content;
            return div;
        }

        function updateSummary() {
            let total = 0;
            let completed = 0;
            let success = 0;

            Object.values(APPLICATION_TYPES).forEach(types => {
                total += types.length;
            });

            Object.values(allResults).forEach(category => {
                Object.values(category).forEach(time => {
                    completed++;
                    if (time && time !== 'æ—¶é—´å¾…æŸ¥è¯¢') {
                        success++;
                    }
                });
            });

            document.getElementById('totalCount').textContent = total;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('successCount').textContent = success;
        }

        function getTreeText() {
            let text = `åŠ æ‹¿å¤§ç§»æ°‘ç”³è¯·å¤„ç†æ—¶é—´ - ${selectedCountry}\n`;
            text += '='.repeat(60) + '\n\n';

            Object.keys(APPLICATION_TYPES).forEach(category => {
                text += `${category}\n`;

                const types = APPLICATION_TYPES[category];
                types.forEach((type, index) => {
                    const isLast = index === types.length - 1;
                    const branch = isLast ? 'â””â”€â”€' : 'â”œâ”€â”€';
                    const time = allResults[category]?.[type] || 'æ—¶é—´å¾…æŸ¥è¯¢';
                    const dots = 'Â·'.repeat(Math.max(2, 50 - type.length));

                    text += `  ${branch} ${type} ${dots} ${time}\n`;
                });

                text += '\n';
            });

            text += '\n' + '='.repeat(60) + '\n';
            text += `æŸ¥è¯¢æ—¥æœŸ: ${new Date().toLocaleDateString('zh-CN')}\n`;
            text += `æ•°æ®æ¥æº: https://www.canada.ca/immigration\n`;

            return text;
        }

        function exportAsText() {
            const text = getTreeText();
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `canada-processing-times-${selectedCountry.replace(/\s+/g, '-')}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportAsJson() {
            const data = {
                country: selectedCountry,
                queryDate: new Date().toISOString(),
                results: allResults
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `canada-processing-times-${selectedCountry.replace(/\s+/g, '-')}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function copyTree() {
            const text = getTreeText();
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('copyTreeBtn');
                const originalText = btn.textContent;
                btn.textContent = 'âœ… å·²å¤åˆ¶ï¼';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            }).catch(err => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }
    </script>
</body>
</html>
